        <!-- Join Room Screen -->
        <div id="join-menu" class="screen">
            <h2>Join Game</h2>
            <div style="margin-bottom:12px;">
                <input id="join-room-code" maxlength="6" placeholder="Room Code" style="width:120px;text-align:center;font-size:18px;" />
            </div>
            <div style="margin-bottom:12px;">
                <input id="join-player-name" maxlength="16" placeholder="Your Name" style="width:180px;font-size:18px;" />
                <button id="random-name-btn" title="Random Name">ğŸ²</button>
            </div>
            <div style="margin-bottom:12px;">
                <label>Character:</label>
                <select id="join-character-select" style="font-size:16px;">
                    <option value="skin1">Skin 1</option>
                    <option value="skin2">Skin 2</option>
                    <option value="skin3">Skin 3</option>
                </select>
            </div>
            <button id="btn-join-room" style="font-size:20px;padding:8px 32px;">Join</button>
            <div id="join-error" style="color:#ff4444;margin-top:10px;font-size:16px;"></div>
            <button id="btn-back-join" style="margin-top:20px;">Back</button>
        </div>
    <!-- HOST GAME MENU -->
    <div id="host-menu" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-host">â† BACK</button>
            <h2>ğŸ‘‘ HOST GAME</h2>
        </div>
        <div class="play-options">
            <div class="option-group">
                <h3>Room Code</h3>
                <div id="host-room-code" class="host-room-code">------</div>
                <div id="host-qr-code" class="host-qr-code"></div>
            </div>
            <div class="option-group">
                <h3>Room Settings</h3>
                <label>Max Players: <input type="number" id="host-max-players" min="2" max="16" value="8"></label>
                <label><input type="checkbox" id="host-lock-room"> Lock Room</label>
                <label><input type="checkbox" id="host-add-bots"> Add Bots</label>
            </div>
            <button class="btn btn-primary btn-large" id="btn-create-room">Create Room</button>
        </div>
    </div>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THE GUN GAME</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/leaderboard.css">
</head>
<body>
        <!-- MOBILE TOUCH CONTROLS -->
        <div id="mobile-controls" style="display:none;position:fixed;z-index:1000;left:0;right:0;bottom:0;width:100vw;height:32vw;pointer-events:none;">
            <div style="position:absolute;left:2vw;bottom:2vw;width:24vw;height:24vw;">
                <div id="touch-joystick" style="width:100%;height:100%;border-radius:50%;background:rgba(255,255,255,0.08);border:2px solid #aaa;pointer-events:auto;"></div>
            </div>
            <div style="position:absolute;right:2vw;bottom:2vw;display:flex;flex-direction:row;gap:2vw;">
                <button id="touch-jump" style="width:12vw;height:12vw;border-radius:50%;font-size:6vw;pointer-events:auto;">â­®</button>
                <button id="touch-fire" style="width:14vw;height:14vw;border-radius:50%;font-size:7vw;background:#ff4444;color:#fff;pointer-events:auto;">â—</button>
            </div>
        </div>
        <!-- PRACTICE MENU -->
        <div id="practice-menu" class="screen">
            <div class="screen-header">
                <button class="btn-back" id="btn-back-practice">â† BACK</button>
                <h2>ğŸ¯ PRACTICE MODE</h2>
            </div>
            <div class="play-options">
                <div class="option-group">
                    <h3>BOT DIFFICULTY</h3>
                    <div class="mode-select">
                        <button class="mode-btn active" data-diff="easy">ğŸŸ¢ Easy</button>
                        <button class="mode-btn" data-diff="medium">ğŸŸ¡ Medium</button>
                        <button class="mode-btn" data-diff="hard">ğŸ”´ Hard</button>
                        <button class="mode-btn" data-diff="insane">ğŸ’€ Insane</button>
                    </div>
                </div>
                <div class="option-group">
                    <h3>WEAPON OPTIONS</h3>
                    <div class="mode-select">
                        <button class="mode-btn active" data-weapon="any">Any Weapon</button>
                        <button class="mode-btn" data-weapon="next">Next Unlock</button>
                        <button class="mode-btn" data-weapon="random">Random Every 30s</button>
                    </div>
                    <label><input type="checkbox" id="infinite-ammo"> Infinite Ammo</label>
                    <label><input type="checkbox" id="no-recoil"> No Recoil</label>
                    <label><input type="checkbox" id="headshot-only"> Headshot Only</label>
                </div>
                <div class="option-group">
                    <h3>TRAINING MAP</h3>
                    <div class="map-select">
                        <button class="map-card active" data-map="aim">ğŸ¯ Aim Map</button>
                        <button class="map-card" data-map="sniper">ğŸ”­ Sniper Lane</button>
                        <button class="map-card" data-map="parkour">ğŸƒ Parkour</button>
                        <button class="map-card" data-map="range">ğŸ¯ Shooting Range</button>
                    </div>
                </div>
                <button class="btn btn-primary btn-large" id="btn-start-practice">START PRACTICE</button>
            </div>
        </div>
    <!-- MAIN MENU -->
    <div id="main-menu" class="screen active">
        <div class="menu-bg"></div>
        <div class="menu-content">
            <h1 class="game-title">THE GUN GAME</h1>
            <div class="player-info">
                <div class="player-level">LVL <span id="menu-level">1</span></div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="menu-xp-bar"></div>
                    <span class="xp-text" id="menu-xp-text">0 / 100 XP</span>
                </div>
            </div>
            <div class="menu-buttons">
                <button class="btn btn-primary" id="btn-play">â–¶ PLAY</button>
                <button class="btn btn-primary" id="btn-practice">ğŸ¯ PRACTICE MODE</button>
                <!-- Host Game and Join Game buttons removed -->
                <button class="btn btn-secondary" id="btn-customize">ğŸ¨ CUSTOMIZE</button>
                <button class="btn btn-secondary" id="btn-challenges">ğŸ“‹ CHALLENGES</button>
                <button class="btn btn-secondary" id="btn-achievements">ğŸ† ACHIEVEMENTS</button>
                <button class="btn btn-secondary" id="btn-how-to-play">â“ HOW TO PLAY</button>
                <button class="btn btn-secondary leaderboard-btn" onclick="openLeaderboard()">ğŸ† LEADERBOARD</button>
            </div>
        </div>
    </div>

    <!-- PLAY MENU -->
    <div id="play-menu" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-play">â† BACK</button>
            <h2>SELECT GAME</h2>
        </div>
        <div class="play-options">
            <div class="option-group">
                <h3>GAME MODE</h3>
                <div class="mode-select">
                    <button class="mode-btn active" data-mode="ffa">ğŸ’€ Free-for-All</button>
                    <button class="mode-btn" data-mode="tdm">ğŸ‘¥ Team Deathmatch</button>
                    <button class="mode-btn" data-mode="ctf">ğŸš© Capture the Flag</button>
                    <button class="mode-btn" data-mode="practice">ğŸ¯ Practice Mode</button>
                </div>
            </div>
            <div class="option-group">
                <h3>PLAYERS</h3>
                <div class="mode-select">
                    <button class="mode-btn active" data-players="1p">ğŸ® Solo</button>
                    <button class="mode-btn" data-players="2p">ğŸ®ğŸ® 2 Players (Split Screen)</button>
                </div>
            </div>
            <div class="option-group">
                <h3>MAP</h3>
                <div class="map-select" id="map-select"></div>
            </div>
            <div class="option-group">
                <h3>BOTS</h3>
                <div class="bot-options">
                    <label>Count: <input type="range" id="bot-count" min="0" max="7" value="3"><span id="bot-count-val">3</span></label>
                    <label>Difficulty:
                        <select id="bot-difficulty">
                            <option value="easy">ğŸŸ¢ Easy</option>
                            <option value="hard" selected>ğŸŸ¡ Hard</option>
                            <option value="pro">ğŸ”´ Pro</option>
                        </select>
                    </label>
                </div>
            </div>
            <button class="btn btn-primary btn-large" id="btn-start-game">âš”ï¸ START MATCH</button>
        </div>
    </div>

    <!-- CUSTOMIZE SCREEN -->
    <div id="customize-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-customize">â† BACK</button>
            <h2>CUSTOMIZE</h2>
            <div class="currency">ğŸ’° <span id="currency-display">0</span></div>
        </div>
        <div class="customize-tabs">
            <button class="tab-btn active" data-tab="skins">ğŸ‘¤ Skins</button>
            <button class="tab-btn" data-tab="weapon-skins">ğŸ”« Weapons</button>
            <button class="tab-btn" data-tab="emotes">ğŸ’ƒ Emotes</button>
            <button class="tab-btn" data-tab="titles">ğŸ·ï¸ Titles</button>
        </div>
        <div class="customize-content" id="customize-content"></div>
    </div>

    <!-- CHALLENGES SCREEN -->
    <div id="challenges-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-challenges">â† BACK</button>
            <h2>ğŸ“‹ DAILY CHALLENGES</h2>
        </div>
        <div class="challenges-list" id="challenges-list"></div>
    </div>

    <!-- ACHIEVEMENTS SCREEN -->
    <div id="achievements-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-achievements">â† BACK</button>
            <h2>ğŸ† ACHIEVEMENTS</h2>
        </div>
        <div class="achievements-list" id="achievements-list"></div>
    </div>

    <!-- HOW TO PLAY SCREEN -->
    <div id="howtoplay-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-howtoplay">â† BACK</button>
            <h2>â“ HOW TO PLAY</h2>
        </div>
        <div class="howtoplay-content">
            <div class="control-group">
                <h3>ğŸƒ Player 1 â€” Movement & Aiming</h3>
                <p><b>Move:</b> <kbd>W</kbd>/<kbd>A</kbd>/<kbd>D</kbd> / Arrow Keys</p>
                <p><b>Jump (Double Jump):</b> <kbd>W</kbd> or <kbd>Space</kbd></p>
                <p><b>Crouch:</b> <kbd>S</kbd></p>
                <p><b>Sprint:</b> <kbd>Shift</kbd></p>
                <p><b>Aim with Mouse:</b> Move mouse to aim</p>
                <p><b>Aim with Keyboard:</b> Arrow Keys when mouse is still</p>
            </div>
            <div class="control-group">
                <h3>ğŸ”« Player 1 â€” Combat</h3>
                <p><kbd>Left Click</kbd> or Hold â€” Shoot</p>
                <p><kbd>R</kbd> â€” Reload</p>
                <p><kbd>1-5</kbd> â€” Switch weapons</p>
            </div>
            <div class="control-group">
                <h3>ğŸ® Player 2 â€” Movement (Split Screen)</h3>
                <p><kbd>I</kbd> â€” Jump / Double Jump</p>
                <p><kbd>J</kbd> â€” Move Left</p>
                <p><kbd>L</kbd> â€” Move Right</p>
                <p><kbd>K</kbd> â€” Crouch</p>
            </div>
            <div class="control-group">
                <h3>ğŸ”« Player 2 â€” Combat</h3>
                <p><kbd>O</kbd> â€” Shoot</p>
                <p><kbd>P</kbd> â€” Reload</p>
                <p><kbd>U</kbd> â€” Aim Left</p>
                <p><kbd>I</kbd> + <kbd>O</kbd> â€” Aim Up</p>
                <p><kbd>7-9</kbd> â€” Switch weapons</p>
                <p>Auto-aims at nearest enemy</p>
            </div>
            <div class="control-group">
                <h3>ğŸ¯ Accuracy Tips</h3>
                <p>â€¢ <b>Crouching</b> greatly reduces weapon spread</p>
                <p>â€¢ <b>Standing still</b> is more accurate than moving</p>
                <p>â€¢ <b>Rapid fire</b> increases recoil â€” pace your shots!</p>
                <p>â€¢ The <b>crosshair</b> shows your current accuracy â€” smaller = more precise</p>
            </div>
            <div class="control-group">
                <h3>âœ¨ Abilities</h3>
                <p><b>P1:</b> <kbd>Q</kbd> Dash, <kbd>E</kbd> Shield, <kbd>F</kbd> Invis</p>
                <p><b>P2:</b> <kbd>N</kbd> Dash, <kbd>M</kbd> Shield, <kbd>,</kbd> Invis</p>
            </div>
            <div class="control-group">
                <h3>ğŸ¯ Objective</h3>
                <p><b>FFA:</b> Most kills wins</p>
                <p><b>TDM:</b> Team with most kills wins</p>
                <p><b>CTF:</b> Capture enemy flag 3 times</p>
            </div>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen">
        <canvas id="game-canvas" style="touch-action:none;width:100vw;height:100vh;max-width:100vw;max-height:100vh;display:block;"></canvas>
        <!-- HUD -->
        <div id="hud">
            <div id="hud-top">
                <div id="hud-timer">3:00</div>
                <div id="hud-score"></div>
                <div id="hud-mode-info"></div>
            </div>
            <div id="hud-bottom">
                <div id="hud-health-container">
                    <div class="hud-label">HP</div>
                    <div class="hud-bar"><div id="hud-health-bar" class="bar-fill health"></div></div>
                    <span id="hud-health-text">100</span>
                </div>
                <div id="hud-weapon-info">
                    <div id="hud-weapon-name">Pistol</div>
                    <div id="hud-ammo">12 / 12</div>
                </div>
                <div id="hud-abilities">
                    <div class="ability" id="ability-dash"><span>Q</span> Dash</div>
                    <div class="ability" id="ability-shield"><span>E</span> Shield</div>
                    <div class="ability" id="ability-invis"><span>F</span> Invis</div>
                </div>
            </div>
            <div id="hud-weapons-bar"></div>
            <div id="hud-killfeed"></div>
            <div id="hud-hitmarker">âœ•</div>
            <div id="hud-damage-overlay"></div>
            <div id="hud-notifications"></div>
        </div>
        <button id="btn-pause" class="btn-pause">â¸</button>
        <button id="btn-fullscreen" class="btn-fullscreen" title="Toggle Fullscreen">â›¶</button>
    </div>

    <!-- PAUSE MENU -->
    <div id="pause-menu" class="overlay hidden">
        <div class="overlay-box">
            <h2>â¸ PAUSED</h2>
            <button class="btn btn-primary" id="btn-resume">â–¶ RESUME</button>
            <button class="btn btn-danger" id="btn-quit">ğŸšª QUIT</button>
        </div>
    </div>

    <!-- MATCH END SCREEN -->
    <div id="match-end" class="overlay hidden">
        <div class="match-end-content">
            <h1 id="match-result"></h1>
            <div id="mvp-section"></div>
            <div id="match-stats"></div>
            <div id="xp-reward"></div>
            <div class="match-end-buttons">
                <button class="btn btn-primary" id="btn-play-again">ğŸ”„ PLAY AGAIN</button>
                <button class="btn btn-secondary" id="btn-to-menu">ğŸ  MENU</button>
            </div>
        </div>
    </div>

    <!-- SCOREBOARD (TAB) -->
    <div id="scoreboard-overlay" class="overlay hidden">
        <div class="scoreboard-box">
            <h2>ğŸ“Š SCOREBOARD</h2>
            <table id="scoreboard-table">
                <thead><tr><th>#</th><th>Player</th><th>K</th><th>D</th><th>Score</th></tr></thead>
                <tbody id="scoreboard-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Fullscreen button on menus -->
    <button id="btn-fullscreen-menu" class="btn-fullscreen-menu">â›¶ Fullscreen</button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
    // --- MOBILE RESPONSIVENESS & TOUCH CONTROLS ---
    function isMobile() {
        return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);
    }
    function showMobileControls(show) {
        document.getElementById('mobile-controls').style.display = show ? 'block' : 'none';
    }
    function resizeCanvas() {
        const canvas = document.getElementById('game-canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', resizeCanvas);
    document.addEventListener('DOMContentLoaded', function() {
        if (isMobile()) {
            document.body.classList.add('mobile');
            showMobileControls(true);
            resizeCanvas();
            // Make all .btn and .mode-btn bigger
            const style = document.createElement('style');
            style.innerHTML = '.btn, .mode-btn, .map-card { font-size:5vw !important; min-height:10vw; min-width:24vw; } .btn-large { font-size:6vw !important; padding:3vw 8vw !important; } .screen { padding-bottom:36vw !important; }';
            document.head.appendChild(style);
        }
    });
    // Touch joystick (simple WASD emulation)
    let joystickActive = false, joyStartX = 0, joyStartY = 0;
    let joyDir = {x:0, y:0};
    const joyElem = document.getElementById('touch-joystick');
    if (joyElem) {
        joyElem.addEventListener('touchstart', e => {
            joystickActive = true;
            const t = e.touches[0];
            joyStartX = t.clientX;
            joyStartY = t.clientY;
        });
        joyElem.addEventListener('touchmove', e => {
            if (!joystickActive) return;
            const t = e.touches[0];
            const dx = t.clientX - joyStartX;
            const dy = t.clientY - joyStartY;
            joyDir.x = Math.max(-1, Math.min(1, dx/60));
            joyDir.y = Math.max(-1, Math.min(1, dy/60));
            // TODO: send joyDir to game input
        });
        joyElem.addEventListener('touchend', e => {
            joystickActive = false;
            joyDir = {x:0, y:0};
            // TODO: send joyDir to game input
        });
    }
    // Touch buttons
    const jumpBtn = document.getElementById('touch-jump');
    if (jumpBtn) jumpBtn.addEventListener('touchstart', e => { e.preventDefault(); /* TODO: trigger jump in game */ });
    const fireBtn = document.getElementById('touch-fire');
    if (fireBtn) fireBtn.addEventListener('touchstart', e => { e.preventDefault(); /* TODO: trigger fire in game */ });
    </script>
    <script src="js/supabase-client.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/game.js"></script>
    <script src="js/player.js"></script>
    <script src="js/weapons.js"></script>
    <script src="js/progression.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/room.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/leaderboard-ui.js"></script>
    <script src="js/gamemode.js"></script>
    <script src="js/map.js"></script>
    <script src="js/bot.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
